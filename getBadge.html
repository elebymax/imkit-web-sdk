<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8>
  <title>IMKit Demo</title>
  <base href=/>
</head>

<body>
  <div id="badge"></div>
  <script type=text/javascript src=static/js/app.js></script>
</body>
<script type=text/javascript>
init();
function init() {
  // ### 建立 APILib
  const APILib = IMKC.getAPILib({
    url: "https://chat.fangho.com/", // chat server
    authUrl: "https://auth.fangho.com", // auth server
    clientKey: "fangho_imkit_0412_2018_001_clientkey",
    // 收到新訊息時執行
    receiveMsg: function(msg) {
      checkBadge();
    },
    // 已讀時執行
    receiveRoom: function(msg) {
      checkBadge();
    }
  });

  // ### 登入 char user
  let clientId = 'gagu';
  APILib.platform.sign({id: clientId}).then(function (res){
    let tokenRes = res;
    let token = tokenRes.token;

    APILib.auth.chatIn(token).then(function(){
      checkBadge()
    });
  });
  // ### 取得 badge
  function checkBadge() {
    APILib.me.getBadge().then(function(res){
      console.log(res.badge);
      document.getElementById('badge').innerText = res.badge;
    });
  }
}

</script>

</html>