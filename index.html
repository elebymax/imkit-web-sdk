<!DOCTYPE html>
<html>
  <head>
    <base href="/" />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"
    />
    <title>IMKit Demo</title>
    <link rel="Shortcut Icon" type="image/x-icon" href="static/logo.png" />
    <link rel="manifest" href="static/manifest.json" />
    <link href="static/css/reset.css" rel="stylesheet" />
    <link href="static/css/index.css" rel="stylesheet" />
    <link href="static/css/app.css" rel="stylesheet" />
  </head>

  <body>
    <div id="IMKitApp"><div class="loader appLoader"></div></div>
    <!-- built files will be auto injected -->
    <script type="text/javascript" src="static/js/manifest.js"></script>
    <script type="text/javascript" src="static/js/vendor.js"></script>
    <script type="text/javascript" src="static/js/app.js"></script>
  </body>

  <script src="static/config.js"></script>
  <script>
    // 處理 query string
    let room = getParameterByName("room");
    let chatActionsPosition = getParameterByName("chatActionsPosition");
    let authClientId = getParameterByName("authClientId");
    let token = getParameterByName("token");
    if (room) {
      config.defaultRoom = room;
    }
    if (chatActionsPosition) {
      config.chat.actionsPosition = chatActionsPosition;
    }
    if (token) {
      config.token = decodeURIComponent(token);
    }
    if (authClientId) {
      config.authClientId = authClientId;
      localStorage.setItem("client", authClientId);
    } else if (localStorage.getItem("client")) {
      config.authClientId = localStorage.getItem("client");
    }

    // 沒有設定 client，導到登入
    if (!config.authClientId && !config.token) {
      if (document.location.href.indexOf("?")) {
        let queryString = document.location.href.split("?");
        queryString.shift();
        document.location.href = "demo?" + queryString.join("?");
      } else {
        document.location.href = "demo";
      }
    }

    // INIT
    window.ImkitJsSDK.init(config);

    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return "";
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
  </script>
</html>
